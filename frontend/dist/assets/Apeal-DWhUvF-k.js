import{a as O,u as P,D as H,r as h,w as B,o as G,k as U,b as w,c,d as T,e as t,f as _,h as s,l as x,q as k,i as D,g as N,j as I,t as g,F as V,s as L,v as Q}from"./index-Cq9TJK2R.js";const Y={class:"container"},K={class:"flex justify-around"},W={class:"flex gap-3 items-center"},X=t("div",{class:"font-bold"},"Familiyasi",-1),Z={class:"w-[150px]"},tt={class:"flex gap-3 items-center"},et=t("div",{class:"font-bold"},"Ismi",-1),at={class:"w-[150px]"},st={class:"flex mt-4 justify-around"},lt={class:"flex gap-3 items-center"},nt=t("div",{class:"font-bold"},"Telefon",-1),ot={class:"w-[150px]"},it={class:"flex gap-3 items-center"},dt=t("div",{class:"font-bold"},"Vaqti",-1),ct={class:"w-[150px]"},rt={class:"mt-4"},ut=t("div",{class:"font-bold"}," Description ",-1),pt={class:"flex justify-around"},ht={class:"mt-4"},_t=t("div",{class:"font-bold"}," Holati ",-1),ft={class:"mt-4"},vt={key:0,class:"font-bold"},mt={class:"flex justify-end mt-5"},gt={__name:"editapeals",setup(R){let f=O();const S=P(),u=H();let b=new Date().getTime();const o=h({firstname:"",lastname:"",phone:"",created_at:"",description:"",status_id:0,reseen:b});B(()=>o,(i,e)=>{i._value.status_id==3?m.value=!0:m.value=!1},{deep:!0});const M=h([]);let r=h(b),m=h(!1),z=async function(){u.modals.editApeal.data.id;let i=localStorage.token,e=await fetch(`${U}apeal/getapeal/apealstatus`,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":i}});if(e.status==401)return S.push("/login");e.status==200&&(e=await e.json(),M.value=[],e.forEach(l=>{M.value.push({value:l.id,label:l.name})}))};G(async()=>{{let{id:i}=u.modals.editApeal.data,e=localStorage.token;i=new Number(i);let l=await fetch(`${U}apeal/getapeal/byid?id=${i}`,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":e}});if(l.status==401)return S.push("/login");l.status==200&&(l=await l.json(),l=l[0],l.created_at=new Date(l.created_at).toLocaleString(),l.reseen&&(m.value=!0,r.value=new Date(l.reseen).getTime()),o.value=l)}await z()});async function C(i){const e=i.reseen,l=new Date(e),A=l.getFullYear(),j=String(l.getMonth()+1).padStart(2,"0"),p=String(l.getDate()).padStart(2,"0");i.reseen=`${A}-${j}-${p}`;let a=localStorage.token;if(i.panding){const{status:d,id:q,reseen:v}=i;try{let y=await fetch(`${U}apeal/edit/byid/${q}`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":a},body:JSON.stringify({status:d,reseen:v})});if(y.status==200){f.success("Ma'lumotlar muvaqiyatli saqlandi"),u.modals.editApeal.show=!1,u.modals.editApeal.data={},u.modals.editApeal.loading=!0;return}if(y.status==401)return S.push("/login");y.status==400&&(y=await y.json(),f.error(y.error))}catch{}}else{const{status:d,id:q}=i;try{let v=await fetch(`${U}apeal/edit/byid/${q}`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":a},body:JSON.stringify({status:d})});if(v.status==200){f.success("Ma'lumotlar muvaqiyatli saqlandi"),u.modals.editApeal.show=!1,u.modals.editApeal.data={},u.modals.editApeal.loading=!0;return}if(v.status==401)return S.push("/login")}catch{}}}return(i,e)=>{const l=w("n-input"),A=w("n-select"),j=w("n-date-picker"),p=w("n-button");return c(),T("div",Y,[t("div",K,[t("div",W,[X,t("div",Z,[_(l,{readonly:"",value:o.value.lastname,"onUpdate:value":e[0]||(e[0]=a=>o.value.lastname=a)},null,8,["value"])])]),t("div",tt,[et,t("div",at,[_(l,{readonly:"",value:o.value.firstname,"onUpdate:value":e[1]||(e[1]=a=>o.value.firstname=a)},null,8,["value"])])])]),t("div",st,[t("div",lt,[nt,t("div",ot,[_(l,{readonly:"",value:o.value.phone,"onUpdate:value":e[2]||(e[2]=a=>o.value.phone=a)},null,8,["value"])])]),t("div",it,[dt,t("div",ct,[_(l,{readonly:"",value:o.value.created_at,"onUpdate:value":e[3]||(e[3]=a=>o.value.created_at=a)},null,8,["value"])])])]),t("div",rt,[ut,_(l,{readonly:"",value:o.value.description,"onUpdate:value":e[4]||(e[4]=a=>o.value.description=a),type:"textarea",placeholder:"Basic Textarea"},null,8,["value"])]),t("div",pt,[t("div",ht,[_t,_(A,{value:o.value.status_id,"onUpdate:value":e[5]||(e[5]=a=>o.value.status_id=a),options:M.value},null,8,["value","options"])]),t("div",ft,[s(m)||o.value.status_id.id==3?(c(),T("div",vt," Vaqti ")):x("",!0),s(m)||o.value.status_id.id==3?(c(),k(j,{key:1,value:s(r),"onUpdate:value":e[6]||(e[6]=a=>D(r)?r.value=a:r=a),type:"date"},null,8,["value"])):x("",!0)])]),t("div",mt,[_(p,{onClick:e[7]||(e[7]=a=>C({status:o.value.status_id,id:s(u).modals.editApeal.data.id,panding:s(m),reseen:s(r)}))},{default:N(()=>[I("Saqlash")]),_:1})])])}}},xt=t("p",{class:"text-lg"},[t("span",{class:"text-[20px] font-bold"}," Murojaatlar ")],-1),yt={class:"mx-auto select-auto mt-5 w-full lg:w-[1200px] items-center gap-4 flex flex-col"},kt={class:"container overflow-x-clip"},wt=t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,[t("div",{class:"text-center"}," F.I ")]),t("th",null,[t("div",{class:"text-center"},"Telefon raqami ")]),t("th",{class:"flex justify-center"},"Tasnifi"),t("th",{class:"text-center"},[t("div",{class:"text-center"},"Holati")]),t("th",{class:"text-center"},[t("div",{class:"text-center"},"Vaqti")]),t("th",{class:"text-center"},"Tahrirlash"),t("th",{class:"text-center"},"Qayta ko'rish"),t("th",{class:"text-center"},[t("div",{class:"text-red-600"},"O'chirish")])])],-1),$t={class:"text-justify ps-4 font-bold"},bt={class:"text-center select-text"},jt={class:"text-center"},Tt={class:"text-center"},St={class:"text-center"},Ct={class:"flex justify-center"},At=t("i",{class:"fas fa-pen"},null,-1),qt={key:0},Dt={key:1},Nt={class:"flex justify-center"},Ut=t("i",{class:"far fa-trash-can"},null,-1),Mt=t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,[t("div",{class:"text-center"}," F.I ")]),t("th",null,[t("div",{class:"text-center"},"Telefon raqami ")]),t("th",{class:"flex justify-center"},"Tasnifi"),t("th",{class:"text-center"},[t("div",{class:"text-center"},"Holati")]),t("th",{class:"text-center"},[t("div",{class:"text-center"},"Vaqti")]),t("th",null,"####")])],-1),zt={class:"text-center font-bold"},Et={class:"text-center"},Vt={class:"text-center"},Bt={class:"text-center"},Ft={class:"text-center"},Lt={class:"text-center"},Ot={class:"font-bold"},Pt=t("span",{class:"text-green-600"},"Barcha ma'lumotlar soni ",-1),Ht=["title"],It={__name:"Apeal",setup(R){let f=H();console.log(f.modals.editApeal);function S(p){f.modals.editApeal.show=!0,f.modals.editApeal.data=p}let u=h(""),$=h(!1),b=h(null),o=async function(){console.log(b.value);let p=localStorage.token;try{let a=await fetch(`${U}apeal/edit/byid/${b.value}`,{method:"DELETE",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":p}});if(a.status==200){m.success("Ma'lumot o'chirilid"),j(r.value);return}if(a.status==401)return A.push("/login");a.status==400&&(a=await a.json(),m.error(a.error))}catch(a){console.log(a)}},M=function(){},r=h(1),m=O(),z=h(10),C=h([]),i=h(1),e=h(!1),l=h(0),A=P();B(r,(p,a)=>{j(p)});let j=async p=>{C.value=[],e.value=!0;let a=localStorage.token;try{let d=await fetch(`${U}apeal/getapeal/all?${new URLSearchParams({page:p,size:z.value}).toString()}`,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8","-x-token":a}});if(d.status==200){d=await d.json(),i.value=Math.ceil(new Number(d[0].total)/10),C.value=[...d],console.log(C.value),e.value=!1,l.value=d[0].total;return}if(d.status==401)return A.push("/login");console.log(d.status)}catch(d){if(d.message=="Failed to fetch")return m.error("Server bilan aloqa uzildi")}};return G(async()=>{j(1)}),B(()=>f.modals.editApeal.loading,(p,a)=>{p&&j(r.value)},{deep:!0}),(p,a)=>{const d=w("n-button"),q=w("n-table"),v=w("n-skeleton"),y=w("n-pagination"),F=w("n-modal");return c(),T(V,null,[t("div",null,[t("div",null,[xt,t("div",yt,[t("div",kt,[s(e)?x("",!0):(c(),k(q,{key:0,bordered:!1,"single-line":!1},{default:N(()=>[wt,t("tbody",null,[(c(!0),T(V,null,L(s(C),(n,E)=>(c(),T("tr",{class:"bg-red-600",key:new Number(n.id)},[t("td",null,g(++E+(s(r)-1)*s(z)),1),t("td",$t,[t("span",{class:Q(n.status==4?"line-through text-red-700":"")},g(n.lastname)+" "+g(n.firstname),3)]),t("td",bt,g(n.phone),1),t("td",jt,g(n.description),1),t("td",Tt,g(n.statusname),1),t("td",St,g(new Date(n.created_at).toLocaleString()),1),t("td",null,[t("div",Ct,[_(d,{type:"tertiary",onClick:J=>S(n)},{default:N(()=>[At]),_:2},1032,["onClick"])])]),n.reseen?(c(),T("td",qt,g(new Date(n.reseen).toLocaleString()),1)):(c(),T("td",Dt,"Mavjud emas")),t("td",null,[t("div",Nt,[_(d,{type:"error",onClick:J=>{D($)?$.value=!0:$=!0,D(b)?b.value=n.id:b=n.id,D(u)?u.value=`${n.lastname} ${n.firstname}dam kelgan taklifni o'chirasizmi ?`:u=`${n.lastname} ${n.firstname}dam kelgan taklifni o'chirasizmi ?`}},{default:N(()=>[Ut]),_:2},1032,["onClick"])])])]))),128))])]),_:1})),s(e)?(c(),k(q,{key:1,bordered:!1,"single-line":!1},{default:N(()=>[Mt,t("tbody",null,[(c(),T(V,null,L(5,(n,E)=>t("tr",{key:E},[t("td",null,g(++E+(s(r)-1)*s(z)),1),t("td",zt,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)]),t("td",Et,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)]),t("td",Vt,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)]),t("td",Bt,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)]),t("td",Ft,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)]),t("td",Lt,[s(e)?(c(),k(v,{key:0,height:"40px",width:"100%"})):x("",!0)])])),64))])]),_:1})):x("",!0)]),_(y,{page:s(r),"onUpdate:page":a[0]||(a[0]=n=>D(r)?r.value=n:r=n),"page-count":s(i)},null,8,["page","page-count"]),t("div",Ot,[Pt,I(": "),t("span",{title:s(l)},g(s(l)),9,Ht)])])])]),_(F,{show:s(f).modals.editApeal.show,"onUpdate:show":a[1]||(a[1]=n=>s(f).modals.editApeal.show=n),class:"custom-card",preset:"card",style:{width:"600px"},title:`${s(f).modals.editApeal.data.lastname} ${s(f).modals.editApeal.data.firstname}`,bordered:!0,size:"huge",segmented:{content:"soft",footer:"soft"}},{default:N(()=>[_(gt)]),_:1},8,["show","title"]),_(F,{show:s($),"onUpdate:show":a[2]||(a[2]=n=>D($)?$.value=n:$=n),preset:"dialog",title:"O'chirish",content:s(u),"positive-text":"Ha","negative-text":"Bekor qilindi",onPositiveClick:s(o),onNegativeClick:s(M)},null,8,["show","content","onPositiveClick","onNegativeClick"])],64)}}};export{It as default};
